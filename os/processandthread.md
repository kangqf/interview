## 进程与线程

### 进程
1. 进程是操作系统内存分配的基本单位，因此进程拥有一个独立的内存空间和寄存器组，而且一个进程崩溃不会影响其它进程。



### 线程



锁 信号量 文件描述符 文件描述符偏移 堆栈  切换  调度 通信  内存地址

进程间相互独立，同一进程的各线程间共享。某进程内的线程在其它进程不可见。

线程上下文切换比进程上下文切换要快得多。

进程间通信IPC，线程间可以直接读写进程数据段（如全局变量）来进行通信——需要进程同步和互斥手段的辅助，以保证数据的一致性。

IPC的方式通常有管道（包括无名管道和命名管道）、消息队列、信号量、共享存储、Socket、Streams等。其中 Socket和Streams支持不同主机上的两个进程IPC。

角色方面：在支持线程机制的系统中，进程是系统资源分配的单位，线程是系统调度的单位。
资源共享方面：进程之间不能共享资源，而线程共享所在进程的地址空间和其它资源。同时线程还有自己的栈和栈指针，程序计数器等寄存器。
独立性方面：进程有自己独立的地址空间，而线程没有，线程必须依赖于进程而存在。

线程的执行特性。

线程只有 3 个基本状态：就绪，执行，阻塞。

线程存在 5 种基本操作来切换线程的状态：派生，阻塞，激活，调度，结束。



### 进程创建 fork

fork()函数一次调用两次返回，对于子进程它返回0，对于父进程它返回子进程的pid。
fork()在子进程需要装载父进程的内存的拷贝时 触发 内存分配，系统会为其分配和父进程相同的内存空间。
fork()还会复制父进程的文件描述符，exec也会保留调用它的进程的文件描述符。fork()不会复制文件描述符偏移，因此文件描述符偏移在父子进程之间是共享的（这一点和dup也是一样的：只复制文件描述符而不复制文件描述符偏移）。

所以就有了IO重定向的思路： fork一个进程，子进程关闭标准输入文件描述符，子进程打开目的IO，exec替换子进程 这样 exec运行的进程 就关联了 替换 标准输入输出 的 目的IO。


### 管道
管道与普通的IO相比有三个优点： 数据长度任意 自我清扫 允许同步

同步的实现是：两个进程通过管道来进行信息的传递，其中一个进程对管道进行读，然后被阻塞，知道另一个进程对同一对管道进行写的时候才会消除之前进程的阻塞，这就实现了进程间的同步。

### Inode
inode 是真正意义上的文件，而同一个文件（inode）会有很多个名字（连接），可以通过link 和 unlink来设置该名字，每个inode是由一个唯一的inode号来标识的，一个文件的inode只有当它的名字（连接）数量变为0的时候才会被清空。






